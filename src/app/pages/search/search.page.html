<ion-header class="ion-no-border">
  <ion-toolbar>
    <div class="search-header">
      <button class="back-btn" (click)="goBack()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </button>
      <div class="search-input-wrap">
        <ion-icon name="search-outline" class="search-icon"></ion-icon>
        <input
          #searchInput
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onSearchInput()"
          [placeholder]="vertical === 'mart' ? 'Search stores, products, groceries...' : 'Search restaurants, dishes, cuisines...'"
          class="search-input"
        />
        <button class="clear-btn" *ngIf="searchTerm" (click)="clearSearch()">
          <ion-icon name="close-circle"></ion-icon>
        </button>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>

  <!-- ========== INITIAL STATE ========== -->
  <ng-container *ngIf="!hasSearched && !isLoading">

    <!-- Recent Searches -->
    <div class="recent-section" *ngIf="recentSearches.length">
      <div class="section-row">
        <span class="section-title">Recent searches</span>
        <span class="clear-all" (click)="clearAllRecent()">Clear all</span>
      </div>
      <div class="recent-list">
        <div class="recent-item" *ngFor="let term of recentSearches; let i = index" (click)="tapRecentSearch(term)">
          <ion-icon name="time-outline" class="recent-icon"></ion-icon>
          <span class="recent-text">{{ term }}</span>
          <button class="recent-remove" (click)="removeRecentSearch(i); $event.stopPropagation()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Browse Categories -->
    <div class="browse-section" *ngIf="apiCategories.length">
      <span class="section-title">Browse categories</span>
      <div class="pillars-scroll">
        <div class="pillar-chip" *ngFor="let cat of apiCategories" (click)="navigatePillar(cat)">
          <div class="pillar-chip-icon" [ngStyle]="{'background-color': getCategoryBgColor(cat.categoryName)}">
            <ion-icon [name]="getCategoryIcon(cat.categoryName)" [ngStyle]="{'color': getCategoryAccentColor(cat.categoryName)}"></ion-icon>
          </div>
          <span class="pillar-chip-name">{{ cat.categoryName }}</span>
        </div>
      </div>
    </div>

    <!-- Popular Cuisines ‚Äî eats only (cuisines are a food concept, not applicable to mart) -->
    <div class="cuisine-section" *ngIf="apiCuisines.length && vertical === 'eats'">
      <span class="section-title">Popular cuisines</span>
      <div class="cuisine-grid">
        <div class="cuisine-item" *ngFor="let cuisine of apiCuisines" (click)="navigateCuisine(cuisine)">
          <div class="cuisine-circle">
            <img *ngIf="cuisine.imageUrl" [src]="imgBaseUrl + cuisine.imageUrl" [alt]="cuisine.name" class="cuisine-img" />
            <span *ngIf="!cuisine.imageUrl" class="cuisine-emoji-fallback">{{ cuisine.icon || 'üçΩÔ∏è' }}</span>
          </div>
          <span class="cuisine-label">{{ cuisine.name }}</span>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- ========== LOADING STATE ========== -->
  <ng-container *ngIf="isLoading">
    <div class="skeleton-section">
      <div class="skeleton-chips">
        <div class="skeleton-chip" *ngFor="let i of [1,2,3]"></div>
      </div>
      <div class="skeleton-cards">
        <div class="skeleton-card" *ngFor="let i of [1,2,3]">
          <div class="skeleton-card-img"></div>
          <div class="skeleton-card-lines">
            <div class="skeleton-line long"></div>
            <div class="skeleton-line short"></div>
          </div>
        </div>
      </div>
      <div class="skeleton-rows">
        <div class="skeleton-row" *ngFor="let i of [1,2]">
          <div class="skeleton-row-img"></div>
          <div class="skeleton-row-lines">
            <div class="skeleton-line long"></div>
            <div class="skeleton-line short"></div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- ========== RESULTS STATE ========== -->
  <ng-container *ngIf="hasSearched && !isLoading">

    <!-- Has results -->
    <ng-container *ngIf="hasResults">

      <!-- Categories Group -->
      <div class="result-group" *ngIf="matchedCategories.length">
        <span class="group-title">Categories</span>
        <div class="category-result" *ngFor="let cat of matchedCategories" (click)="navigateCategory(cat)">
          <div class="category-result-icon" [ngStyle]="{'background-color': cat.bgColor}">
            <ion-icon [name]="cat.icon" [ngStyle]="{'color': cat.accentColor}"></ion-icon>
          </div>
          <span class="category-result-name">{{ cat.name }}</span>
          <ion-icon name="chevron-forward-outline" class="result-chevron"></ion-icon>
        </div>
      </div>

      <!-- Vendors Group -->
      <div class="result-group" *ngIf="matchedVendors.length">
        <span class="group-title">{{ vertical === 'mart' ? 'Stores' : 'Restaurants' }}</span>
        <div class="vendor-result" *ngFor="let vendor of matchedVendors" (click)="navigateVendor(vendor)">
          <div class="vendor-img">
            <img *ngIf="vendor.imageUrl" [src]="vendor.imageUrl" alt="" />
            <ion-icon *ngIf="!vendor.imageUrl" name="storefront-outline" class="vendor-placeholder"></ion-icon>
          </div>
          <div class="vendor-info">
            <span class="vendor-name">{{ vendor.vendorName }}</span>
            <span class="vendor-meta">{{ vendor.cuisine || '' }}
              <ng-container *ngIf="vendor.distance"> &bull; {{ vendor.distance }}</ng-container>
              <ng-container *ngIf="vendor.deliveryTime"> &bull; {{ vendor.deliveryTime }}</ng-container>
            </span>
          </div>
          <div class="vendor-rating" *ngIf="vendor.rating">
            <ion-icon name="star" class="star-icon"></ion-icon>
            <span>{{ vendor.rating }}</span>
          </div>
        </div>
      </div>

      <!-- Dishes / Products Group -->
      <div class="result-group" *ngIf="matchedProducts.length">
        <span class="group-title">{{ vertical === 'mart' ? 'Products' : 'Dishes' }}</span>
        <div class="product-result" *ngFor="let product of matchedProducts" (click)="navigateProduct(product)">
          <div class="product-img">
            <img *ngIf="product.imageUrl" [src]="product.imageUrl" alt="" />
            <ion-icon *ngIf="!product.imageUrl" [name]="vertical === 'mart' ? 'cube-outline' : 'fast-food-outline'" class="product-placeholder"></ion-icon>
            <span class="product-discount-badge" *ngIf="product.discount">{{ getDiscountLabel(product) }}</span>
          </div>
          <div class="product-info">
            <span class="product-name">{{ product.productName }}</span>
            <span class="product-vendor">{{ product.vendorName }}</span>
            <span class="product-tag" *ngIf="product.tag && getTagLabel(product.tag)">{{ getTagLabel(product.tag) }}</span>
          </div>
          <div class="product-price-group" *ngIf="product.price">
            <span class="product-price">&#x20B9;{{ product.price }}</span>
            <span class="product-original-price" *ngIf="product.discount && product.actualPrice > product.price">&#x20B9;{{ product.actualPrice }}</span>
          </div>
        </div>
      </div>

    </ng-container>

    <!-- Empty State -->
    <ng-container *ngIf="!hasResults">
      <div class="empty-state">
        <ion-icon name="search-outline" class="empty-icon"></ion-icon>
        <span class="empty-title">No results for "{{ searchTerm }}"</span>
        <span class="empty-subtitle">Try a different search{{ vertical === 'eats' ? ' or browse popular cuisines' : '' }}</span>
      </div>

      <!-- Fallback cuisine grid ‚Äî eats only -->
      <div class="cuisine-section fallback-cuisines" *ngIf="apiCuisines.length && vertical === 'eats'">
        <span class="section-title">Popular cuisines</span>
        <div class="cuisine-grid">
          <div class="cuisine-item" *ngFor="let cuisine of apiCuisines" (click)="navigateCuisine(cuisine)">
            <div class="cuisine-circle">
              <img *ngIf="cuisine.imageUrl" [src]="imgBaseUrl + cuisine.imageUrl" [alt]="cuisine.name" class="cuisine-img" />
              <span *ngIf="!cuisine.imageUrl" class="cuisine-emoji-fallback">{{ cuisine.icon || 'üçΩÔ∏è' }}</span>
            </div>
            <span class="cuisine-label">{{ cuisine.name }}</span>
          </div>
        </div>
      </div>
    </ng-container>

  </ng-container>

  <div style="height: 24px;"></div>
</ion-content>
