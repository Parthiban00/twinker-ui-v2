import{a as y}from"./chunk-XHFPWJXB.js";import{a as $}from"./chunk-5L56GRTK.js";import{a as Z}from"./chunk-RUV2QHWV.js";import"./chunk-G4UC2DN7.js";import{a as X}from"./chunk-4TOLQR2K.js";import{$a as Y,B as _,Ba as z,C as o,D as a,Da as B,E as g,Ha as N,Hb as K,I as S,J as m,K as T,Ka as W,Ma as D,O as b,Q as v,Qa as F,S as u,Sa as L,Ta as A,U as I,Va as U,W as x,X as P,Xb as Q,Y as O,db as q,kb as G,la as E,m as C,o as l,p as c,qb as H,tb as J,u as s,va as j,w as h,x as R,y as M,z as V}from"./chunk-GJ24JKLH.js";import"./chunk-B3I3XDBM.js";import"./chunk-QUJFQN2Y.js";import"./chunk-KSM42KW3.js";import"./chunk-KAYW723Y.js";import"./chunk-ZJWVYB4W.js";import"./chunk-WVHTM5RI.js";import"./chunk-IN6HLDFE.js";import"./chunk-GIMG75PD.js";import"./chunk-O5IUGFKF.js";import"./chunk-LHDZOLCP.js";import"./chunk-AEZ3F2AP.js";import"./chunk-7FY2OE2O.js";import"./chunk-5KM5ZX5B.js";import"./chunk-EAHJVID6.js";import"./chunk-FOH2II3V.js";import"./chunk-VZWY4NEG.js";import"./chunk-WI5MSH4N.js";import"./chunk-5SJVYNIP.js";import"./chunk-CKP3SGE2.js";import"./chunk-QLR5SVGL.js";import"./chunk-JHI3MBHO.js";function ne(i,w){if(i&1&&(o(0,"div",30),g(1,"ion-icon",31),o(2,"span"),u(3),a()()),i&2){let r=T();s(3),I("",r.resendCountdown,"s")}}function oe(i,w){if(i&1){let r=S();o(0,"span",32),m("click",function(){l(r);let e=T();return c(e.resentOtp())}),u(1,"Resend OTP"),a()}}function re(i,w){i&1&&(o(0,"span"),u(1,"Verify & Continue"),a())}function se(i,w){i&1&&g(0,"ion-spinner",33)}var te=(()=>{class i{constructor(r,n,e,p,d,t){this.activatedRoute=r,this.otpService=n,this.commonService=e,this.router=p,this.storageService=d,this.navCtrl=t,this.otp={first:"",second:"",third:"",fourth:""},this.resendDisabled=!0,this.resendCountdown=20,this.loading=!1,this.activatedRoute.queryParams.subscribe(f=>{this.mobileNo=f.mobileNo,this.mobileNo&&this.mobileNo.length>=4?this.maskedPhone="******"+this.mobileNo.slice(-4):this.maskedPhone=this.mobileNo||""})}ngOnInit(){this.startResendTimer()}ngOnDestroy(){this.clearResendTimer()}startResendTimer(){this.resendDisabled=!0,this.resendCountdown=20,this.clearResendTimer(),this.resendInterval=setInterval(()=>{this.resendCountdown--,this.resendCountdown<=0&&(this.resendDisabled=!1,this.clearResendTimer())},1e3)}clearResendTimer(){this.resendInterval&&(clearInterval(this.resendInterval),this.resendInterval=null)}get isOtpComplete(){return!!(this.otp.first&&this.otp.second&&this.otp.third&&this.otp.fourth)}otpController(r,n,e){r.target.value.length<1&&e?e.setFocus():n&&r.target.value.length>0&&n.setFocus()}goBack(){this.navCtrl.back()}verifyOtpAndLogin(){let r=`${this.otp.first}${this.otp.second}${this.otp.third}${this.otp.fourth}`;if(this.mobileNo&&r.length===4&&!this.loading){this.loading=!0;let n={mobileNo:this.mobileNo,otp:r};this.otpService.login(n).subscribe({next:e=>{this.loading=!1,e.status?(this.commonService.presentToast("bottom",e.message,"success"),e.data&&(e.data.token&&this.storageService.saveToken(e.data.token),e.data.user&&this.storageService.saveUser(e.data.user),e.data.hasDefaultAddress?this.router.navigate(["/tabs/"],{replaceUrl:!0}):this.router.navigate(["/shared/location-setup"],{replaceUrl:!0}))):this.commonService.presentToast("bottom",e.message,"danger")},error:e=>{this.loading=!1,this.commonService.presentToast("bottom","Invalid OTP or verification failed. Please try again.","danger")}})}}resentOtp(){if(this.mobileNo&&!this.resendDisabled){let r={mobileNo:this.mobileNo};this.otpService.resendOTP(r).subscribe({next:n=>{n.status?(this.commonService.presentToast("bottom",n.message,"success"),this.startResendTimer()):this.commonService.presentToast("bottom",n.message,"danger")},error:n=>{this.commonService.presentToast("bottom","Failed to resend OTP. Please try again.","danger")}})}}static{this.\u0275fac=function(n){return new(n||i)(h(z),h(y),h($),h(B),h(X),h(U))}}static{this.\u0275cmp=R({type:i,selectors:[["app-otp-verification"]],standalone:!1,decls:41,vars:21,consts:[["otp1",""],["otp2",""],["otp3",""],["otp4",""],[1,"otp-content",3,"scrollY"],[1,"top-strip"],[1,"strip-bg"],[1,"strip-decor"],[1,"circle","c1"],[1,"circle","c2"],[1,"strip-content"],["fill","clear",1,"back-btn",3,"click"],["slot","icon-only","name","arrow-back-outline"],[1,"shield-icon"],["name","shield-checkmark"],[1,"otp-card"],[1,"otp-title"],[1,"otp-subtitle"],[1,"phone-number"],[1,"otp-boxes"],[1,"otp-box-wrap"],["maxlength","1","inputmode","numeric",1,"otp-box",3,"ngModelChange","keyup","ngModel"],[1,"resend-row"],[1,"resend-text"],[1,"resend-action"],["class","timer-badge",4,"ngIf"],["class","resend-link",3,"click",4,"ngIf"],[1,"verify-btn",3,"click","disabled"],[4,"ngIf"],["name","crescent",4,"ngIf"],[1,"timer-badge"],["name","time-outline"],[1,"resend-link",3,"click"],["name","crescent"]],template:function(n,e){if(n&1){let p=S();o(0,"ion-content",4)(1,"div",5),g(2,"div",6),o(3,"div",7),g(4,"div",8)(5,"div",9),a(),o(6,"div",10)(7,"ion-button",11),m("click",function(){return l(p),c(e.goBack())}),g(8,"ion-icon",12),a(),o(9,"div",13),g(10,"ion-icon",14),a()()(),o(11,"div",15)(12,"h1",16),u(13,"Verify Your Number"),a(),o(14,"p",17),u(15," Enter the 4-digit code sent to"),g(16,"br"),o(17,"span",18),u(18),a()(),o(19,"div",19)(20,"div",20)(21,"ion-input",21,0),O("ngModelChange",function(t){return l(p),P(e.otp.first,t)||(e.otp.first=t),c(t)}),m("keyup",function(t){l(p);let f=b(25);return c(e.otpController(t,f,null))}),a()(),o(23,"div",20)(24,"ion-input",21,1),O("ngModelChange",function(t){return l(p),P(e.otp.second,t)||(e.otp.second=t),c(t)}),m("keyup",function(t){l(p);let f=b(22),k=b(28);return c(e.otpController(t,k,f))}),a()(),o(26,"div",20)(27,"ion-input",21,2),O("ngModelChange",function(t){return l(p),P(e.otp.third,t)||(e.otp.third=t),c(t)}),m("keyup",function(t){l(p);let f=b(25),k=b(31);return c(e.otpController(t,k,f))}),a()(),o(29,"div",20)(30,"ion-input",21,3),O("ngModelChange",function(t){return l(p),P(e.otp.fourth,t)||(e.otp.fourth=t),c(t)}),m("keyup",function(t){l(p);let f=b(28);return c(e.otpController(t,null,f))}),a()()(),o(32,"div",22)(33,"span",23),u(34,"Didn't receive code?"),a(),o(35,"div",24),V(36,ne,4,1,"div",25)(37,oe,2,0,"span",26),a()(),o(38,"button",27),m("click",function(){return l(p),c(e.verifyOtpAndLogin())}),V(39,re,2,0,"span",28)(40,se,1,0,"ion-spinner",29),a()()()}n&2&&(_("scrollY",!1),s(18),I("+91 ",e.maskedPhone),s(2),v("filled",e.otp.first),s(),x("ngModel",e.otp.first),s(2),v("filled",e.otp.second),s(),x("ngModel",e.otp.second),s(2),v("filled",e.otp.third),s(),x("ngModel",e.otp.third),s(2),v("filled",e.otp.fourth),s(),x("ngModel",e.otp.fourth),s(6),_("ngIf",e.resendDisabled),s(),_("ngIf",!e.resendDisabled),s(),v("disabled",!e.isOtpComplete),_("disabled",e.loading||!e.isOtpComplete),s(),_("ngIf",!e.loading),s(),_("ngIf",e.loading))},dependencies:[E,W,F,D,q,G,H,J,K,Y],styles:[".otp-content[_ngcontent-%COMP%]{--ion-background-color: #f5f5f5}.top-strip[_ngcontent-%COMP%]{position:relative;height:200px;overflow:hidden}.strip-bg[_ngcontent-%COMP%]{position:absolute;inset:0;background:linear-gradient(135deg,#f85c70,#fc8c5c);border-radius:0 0 32px 32px}.strip-decor[_ngcontent-%COMP%]{position:absolute;inset:0;pointer-events:none}.strip-decor[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%]{position:absolute;border-radius:50%;background:#ffffff14}.strip-decor[_ngcontent-%COMP%]   .c1[_ngcontent-%COMP%]{width:140px;height:140px;top:-30px;left:-30px}.strip-decor[_ngcontent-%COMP%]   .c2[_ngcontent-%COMP%]{width:80px;height:80px;bottom:10px;right:20px;background:#ffffff1a}.strip-content[_ngcontent-%COMP%]{position:relative;z-index:1;padding:16px 16px 0}.back-btn[_ngcontent-%COMP%]{--color: #ffffff;--padding-start: 4px;--padding-end: 4px;margin:0 0 12px;height:40px;width:40px;min-width:40px}.back-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px}.shield-icon[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:50%;background:#fff3;backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;margin:0 auto}.shield-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:34px;color:#fff}.otp-card[_ngcontent-%COMP%]{position:relative;z-index:2;margin:-32px 20px 0;background:#fff;border-radius:24px;padding:32px 24px 28px;box-shadow:0 8px 32px #00000014}.otp-title[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:22px;color:#1a1a1a;margin:0 0 8px;text-align:center}.otp-subtitle[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:14px;color:#888;margin:0 0 32px;text-align:center;line-height:1.5}.otp-subtitle[_ngcontent-%COMP%]   .phone-number[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;color:#1a1a1a;font-size:15px}.otp-boxes[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:14px;margin-bottom:28px}.otp-box-wrap[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:14px;background:#f8f8f8;border:1.5px solid #e8e8e8;transition:all .2s ease;overflow:hidden}.otp-box-wrap.filled[_ngcontent-%COMP%]{border-color:#f85c70;background:#fff5f5;box-shadow:0 2px 8px #f85c701a}.otp-box-wrap[_ngcontent-%COMP%]   .otp-box[_ngcontent-%COMP%]{width:100%;height:100%;text-align:center;font-size:24px;font-family:latoBold,sans-serif;color:#1a1a1a;--padding-start: 0;--padding-end: 0;--padding-top: 0;--padding-bottom: 0;--background: transparent}.otp-box-wrap[_ngcontent-%COMP%]   .otp-box.has-focus[_ngcontent-%COMP%]{border:none}.resend-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:28px}.resend-text[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:13px;color:#888}.resend-action[_ngcontent-%COMP%]   .timer-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;background:#f0f0f0;padding:4px 12px;border-radius:20px;font-family:latoBold,sans-serif;font-size:13px;color:#666}.resend-action[_ngcontent-%COMP%]   .timer-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.resend-action[_ngcontent-%COMP%]   .resend-link[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:13px;color:#f85c70;cursor:pointer;padding:4px 0}.resend-action[_ngcontent-%COMP%]   .resend-link[_ngcontent-%COMP%]:active{opacity:.7}.verify-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:54px;border:none;border-radius:30px;background:linear-gradient(135deg,#f85c70,#fc8c5c);color:#fff;font-family:latoBold,sans-serif;font-size:16px;font-weight:600;letter-spacing:.5px;cursor:pointer;transition:opacity .2s ease,transform .1s ease;box-shadow:0 4px 16px #f85c704d}.verify-btn[_ngcontent-%COMP%]:active{transform:scale(.98)}.verify-btn.disabled[_ngcontent-%COMP%]{opacity:.4;cursor:not-allowed;box-shadow:none}.verify-btn[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:24px;height:24px;--color: #ffffff}"]})}}return i})();var ae=[{path:"",component:te}],ie=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=M({type:i})}static{this.\u0275inj=C({imports:[N.forChild(ae),N]})}}return i})();var ke=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=M({type:i})}static{this.\u0275inj=C({providers:[Z,y],imports:[j,L,Q,ie,A]})}}return i})();export{ke as OtpVerificationPageModule};
