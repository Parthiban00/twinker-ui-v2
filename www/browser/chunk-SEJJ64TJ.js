import{a,b as u}from"./chunk-UVB6L6ON.js";import{a as p}from"./chunk-EVNIR4QR.js";import{b as m}from"./chunk-ATZI6UPN.js";import{a as l}from"./chunk-UGG7OXGH.js";import{Fa as f,l as d,n as o}from"./chunk-U3GTSJOD.js";import{e as c}from"./chunk-JHI3MBHO.js";var r=u("PushNotifications",{});var h="twinker_orders",j=(()=>{class s{constructor(i,e,t,n){this.web=i,this.storage=e,this.commonService=t,this.router=n,this.listenersAdded=!1}init(){return c(this,null,function*(){!a.isNativePlatform()||(a.getPlatform()==="android"&&(yield r.createChannel({id:h,name:"Twinker Orders",description:"Order status updates and delivery notifications",importance:5,sound:"default",vibration:!0,visibility:1})),(yield r.requestPermissions()).receive!=="granted")||(yield r.register(),!this.listenersAdded&&(this.listenersAdded=!0,yield r.addListener("registration",e=>{let t=this.storage.getUser();t?._id&&this.web.patch(`users/${t._id}/fcm-token`,{token:e.value}).subscribe({error:()=>{}})}),yield r.addListener("registrationError",e=>{console.warn("[FCM] Registration error:",e)}),yield r.addListener("pushNotificationReceived",e=>{let t=e.title||"Twinker",n=e.body||"";this.commonService.presentToast("top",`${t}: ${n}`,"primary")}),yield r.addListener("pushNotificationActionPerformed",e=>{let t=e.notification.data||{};this.handleNotificationTap(t)})))})}clearToken(){return c(this,null,function*(){if(!a.isNativePlatform())return;let i=this.storage.getUser();i?._id&&this.web.delete(`users/${i._id}/fcm-token`).subscribe({error:()=>{}}),yield r.removeAllListeners(),this.listenersAdded=!1})}handleNotificationTap(i){let{type:e,orderId:t}=i;if(e)switch(e){case"new_order":case"order_cancelled":this.router.navigate(["/vendor-orders"]);break;case"order_ready_for_pickup":this.router.navigate(["/delivery-orders"]);break;case"order_confirmed":case"delivery_assigned":case"out_for_delivery":case"delivered":case"vendor_cancelled":this.router.navigate(["/tabs/orders"]);break;default:this.router.navigate(["/tabs/home"])}}static{this.\u0275fac=function(e){return new(e||s)(o(m),o(l),o(p),o(f))}}static{this.\u0275prov=d({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{j as a};
