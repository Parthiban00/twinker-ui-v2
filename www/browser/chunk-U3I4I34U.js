import{a as L}from"./chunk-GDHFQSGU.js";import{a as H}from"./chunk-EVNIR4QR.js";import{B as s,C as t,D as i,E as d,I as S,J as P,Ja as b,Jb as N,K as f,Lb as V,Nb as Y,Q as v,S as a,T as g,U as m,Ua as F,V as E,Wb as G,Zb as $,fb as z,gb as T,m as u,ma as k,mb as A,na as w,o as h,p as M,pb as D,rb as j,sb as R,u as o,w as y,x as I,xa as B,y as _,z as p}from"./chunk-U3GTSJOD.js";import{a as C,b as O}from"./chunk-JHI3MBHO.js";function J(e,c){if(e&1&&(t(0,"div",38),d(1,"ion-icon",39),t(2,"span"),a(3),i()()),e&2){let n=f();o(3),m("You're saving \u20B9 ",n.totalSaved.toFixed(2)," on this order")}}function K(e,c){if(e&1&&(t(0,"div",42)(1,"span"),a(2,"Coupon discount"),i(),t(3,"span",44),a(4),i()()),e&2){let n=f(2);o(4),m("-\u20B9",n.couponDiscount.toFixed(2))}}function Q(e,c){if(e&1&&(t(0,"span"),a(1),i()),e&2){let n=f(2);o(),m("\u20B9",n.deliveryFee.toFixed(2))}}function W(e,c){e&1&&(t(0,"span",44),a(1,"FREE"),i())}function Z(e,c){if(e&1&&(t(0,"div",42)(1,"span"),a(2,"Platform fee"),i(),t(3,"span"),a(4),i()()),e&2){let n=f(2);o(4),m("\u20B9",n.platformFee.toFixed(2))}}function ee(e,c){if(e&1&&(t(0,"div",42)(1,"span"),a(2),i(),t(3,"span"),a(4),i()()),e&2){let n=f(2);o(2),g(n.feeBreakdown.tax.label),o(2),m("\u20B9",n.taxAmount.toFixed(2))}}function te(e,c){if(e&1&&(t(0,"div",40),p(1,K,5,1,"div",41),t(2,"div",42)(3,"span"),a(4,"Delivery"),i(),p(5,Q,2,1,"span",36)(6,W,2,0,"span",43),i(),p(7,Z,5,1,"div",41)(8,ee,5,2,"div",41),i()),e&2){let n=f();o(),s("ngIf",n.couponDiscount>0),o(4),s("ngIf",!n.feeBreakdown.delivery.freeDeliveryApplied),o(),s("ngIf",n.feeBreakdown.delivery.freeDeliveryApplied),o(),s("ngIf",n.platformFee>0),o(),s("ngIf",n.taxAmount>0)}}function ne(e,c){e&1&&d(0,"div",55)}function ie(e,c){e&1&&(t(0,"span",56),a(1,"Soon"),i())}function oe(e,c){if(e&1){let n=S();t(0,"button",45),P("click",function(){let r=h(n).$implicit,x=f();return M(x.selectPayment(r.id))}),t(1,"div",46)(2,"div",47),p(3,ne,1,0,"div",48),i()(),t(4,"div",49),d(5,"ion-icon",50),i(),t(6,"div",51)(7,"span",52),a(8),i(),t(9,"span",53),a(10),i()(),p(11,ie,2,0,"span",54),i()}if(e&2){let n=c.$implicit,l=f();v("selected",l.selectedPayment===n.id)("disabled",!n.enabled),o(3),s("ngIf",l.selectedPayment===n.id),o(),v("disabled-icon",!n.enabled),o(),s("name",n.icon),o(3),g(n.name),o(2),g(n.description),o(),s("ngIf",!n.enabled)}}function ae(e,c){e&1&&(t(0,"div",57),d(1,"ion-icon",58),t(2,"span"),a(3,"Please keep exact change ready for the delivery partner"),i()())}function re(e,c){if(e&1&&(t(0,"div",59),d(1,"ion-icon",60),t(2,"span"),a(3),i()()),e&2){let n=f();o(3),g(n.placeError)}}function le(e,c){e&1&&(t(0,"span"),a(1,"Confirm & Place Order"),i())}function se(e,c){e&1&&(t(0,"span",61),d(1,"ion-spinner",62),a(2," Placing order... "),i())}var X=(()=>{class e{constructor(n,l,r){this.modalCtrl=n,this.orderService=l,this.commonService=r,this.totalAmount=0,this.totalItems=0,this.totalSaved=0,this.deliveryAddress="",this.deliveryFee=0,this.platformFee=0,this.taxAmount=0,this.feeBreakdown=null,this.appliedOffer=null,this.couponDiscount=0,this.orderPayload=null,this.selectedPayment="COD",this.isPlacing=!1,this.placeError="",this.paymentOptions=[{id:"COD",name:"Cash on Delivery",description:"Pay when your order arrives",icon:"cash-outline",enabled:!0},{id:"PG",name:"Payment Gateway",description:"Coming soon",icon:"card-outline",enabled:!1}]}ngOnInit(){}selectPayment(n){this.paymentOptions.find(r=>r.id===n)?.enabled&&(this.selectedPayment=n)}cancel(){if(!this.isPlacing)return this.modalCtrl.dismiss(null,"cancel")}confirmOrder(){if(this.isPlacing||!this.orderPayload)return;this.isPlacing=!0,this.placeError="";let n=O(C({},this.orderPayload),{paymentMethod:this.selectedPayment==="COD"?"cod":"online"});this.orderService.placeOrder(n).subscribe({next:l=>{l?.status&&l?.data?this.modalCtrl.dismiss({orderId:l.data.orderId,_id:l.data._id},"confirm"):(this.placeError=l?.message||"Failed to place order. Please try again.",this.isPlacing=!1)},error:l=>{let r=l?.error;if(r?.code==="VENDOR_UNAVAILABLE"){let x=(r.closedVendors||[]).join(", ");this.placeError=`Some vendors are currently closed: ${x}. Please remove them or try again later.`}else r?.code==="ACTIVE_ORDER_EXISTS"?this.placeError='You already have an active order. Go back to cart and choose "Place anyway".':this.placeError=r?.message||"Failed to place order. Please try again.";this.isPlacing=!1}})}static{this.\u0275fac=function(l){return new(l||e)(y(G),y(L),y(H))}}static{this.\u0275cmp=I({type:e,selectors:[["app-payment"]],inputs:{totalAmount:"totalAmount",totalItems:"totalItems",totalSaved:"totalSaved",deliveryAddress:"deliveryAddress",deliveryFee:"deliveryFee",platformFee:"platformFee",taxAmount:"taxAmount",feeBreakdown:"feeBreakdown",appliedOffer:"appliedOffer",couponDiscount:"couponDiscount",orderPayload:"orderPayload"},standalone:!1,decls:55,vars:16,consts:[[1,"ion-no-border"],["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back","color","dark"],[1,"payment-title"],[1,"payment-content",3,"scrollY"],[1,"order-summary-card"],[1,"summary-top"],[1,"summary-icon-wrap"],["name","receipt-outline"],[1,"summary-details"],[1,"summary-label"],[1,"summary-amount"],[1,"summary-badge"],[1,"badge-text"],["class","savings-strip",4,"ngIf"],["class","fee-mini-summary",4,"ngIf"],[1,"section"],[1,"section-label"],["name","location-outline",1,"section-icon"],[1,"address-card"],[1,"address-left"],[1,"address-tag"],["name","business-outline"],[1,"address-text"],[1,"change-link"],["name","wallet-outline",1,"section-icon"],[1,"payment-options"],["class","payment-option",3,"selected","disabled","click",4,"ngFor","ngForOf"],["class","info-note",4,"ngIf"],["class","error-note",4,"ngIf"],[1,"confirm-footer"],[1,"footer-top"],[1,"footer-total-label"],[1,"footer-total-amount"],[1,"confirm-btn",3,"click","disabled"],[4,"ngIf"],["class","placing-text",4,"ngIf"],[1,"savings-strip"],["name","pricetag-outline"],[1,"fee-mini-summary"],["class","fee-mini-row",4,"ngIf"],[1,"fee-mini-row"],["class","fee-mini-green",4,"ngIf"],[1,"fee-mini-green"],[1,"payment-option",3,"click"],[1,"option-radio"],[1,"radio-outer"],["class","radio-inner",4,"ngIf"],[1,"option-icon-wrap"],[3,"name"],[1,"option-text"],[1,"option-name"],[1,"option-desc"],["class","soon-tag",4,"ngIf"],[1,"radio-inner"],[1,"soon-tag"],[1,"info-note"],["name","information-circle-outline"],[1,"error-note"],["name","alert-circle-outline"],[1,"placing-text"],["name","crescent",1,"btn-spinner"]],template:function(l,r){l&1&&(t(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),P("click",function(){return r.cancel()}),d(4,"ion-icon",3),i()(),t(5,"ion-title",4),a(6,"Confirm Order"),i()()(),t(7,"ion-content",5)(8,"div",6)(9,"div",7)(10,"div",8),d(11,"ion-icon",9),i(),t(12,"div",10)(13,"span",11),a(14,"Order Total"),i(),t(15,"span",12),a(16),i()(),t(17,"div",13)(18,"span",14),a(19),i()()(),p(20,J,4,1,"div",15),i(),p(21,te,9,5,"div",16),t(22,"div",17)(23,"div",18),d(24,"ion-icon",19),t(25,"span"),a(26,"Delivering to"),i()(),t(27,"div",20)(28,"div",21)(29,"span",22),d(30,"ion-icon",23),a(31," Office "),i(),t(32,"p",24),a(33),i()(),t(34,"button",25),a(35,"Change"),i()()(),t(36,"div",17)(37,"div",18),d(38,"ion-icon",26),t(39,"span"),a(40,"Payment method"),i()(),t(41,"div",27),p(42,oe,12,11,"button",28),i()(),p(43,ae,4,0,"div",29)(44,re,4,1,"div",30),i(),t(45,"ion-footer",0)(46,"div",31)(47,"div",32)(48,"span",33),a(49,"Total"),i(),t(50,"span",34),a(51),i()(),t(52,"button",35),P("click",function(){return r.confirmOrder()}),p(53,le,2,0,"span",36)(54,se,3,0,"span",37),i()()()),l&2&&(o(7),s("scrollY",!0),o(9),m("\u20B9 ",r.totalAmount.toFixed(2)),o(3),E("",r.totalItems," ",r.totalItems===1?"item":"items"),o(),s("ngIf",r.totalSaved>0),o(),s("ngIf",r.feeBreakdown),o(12),g(r.deliveryAddress||"Default delivery address"),o(9),s("ngForOf",r.paymentOptions),o(),s("ngIf",r.selectedPayment==="COD"),o(),s("ngIf",r.placeError),o(7),m("\u20B9 ",r.totalAmount.toFixed(2)),o(),v("placing",r.isPlacing),s("disabled",r.isPlacing),o(),s("ngIf",!r.isPlacing),o(),s("ngIf",r.isPlacing))},dependencies:[k,w,z,T,A,D,j,R,N,V,Y],styles:["ion-toolbar[_ngcontent-%COMP%]{--background: #fff;--border-width: 0}.payment-title[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:18px;color:#1a1a1a}.payment-content[_ngcontent-%COMP%]{--background: #fff}ion-footer[_ngcontent-%COMP%]{background:#fff}.order-summary-card[_ngcontent-%COMP%]{margin:16px 20px 20px;background:linear-gradient(135deg,#f85c70,#fc5c7d);border-radius:16px;overflow:hidden}.summary-top[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;padding:18px 18px 14px}.summary-icon-wrap[_ngcontent-%COMP%]{width:44px;height:44px;background:#fff3;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.summary-icon-wrap[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px;color:#fff}.summary-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:2px}.summary-label[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:13px;color:#fffc}.summary-amount[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:22px;color:#fff;letter-spacing:.3px}.summary-badge[_ngcontent-%COMP%]{background:#fff3;border-radius:20px;padding:5px 12px;flex-shrink:0}.summary-badge[_ngcontent-%COMP%]   .badge-text[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:12px;color:#fff}.savings-strip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#ffffff26;padding:10px 18px}.savings-strip[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px;color:#fff}.savings-strip[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:13px;color:#fff}.fee-mini-summary[_ngcontent-%COMP%]{margin:0 20px 16px;padding:12px 14px;background:#fafafa;border:1px solid #f0f0f0;border-radius:12px}.fee-mini-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:3px 0;font-family:latoRegular,sans-serif;font-size:13px;color:#888}.fee-mini-row[_ngcontent-%COMP%]   .fee-mini-green[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;color:#2ecc71}.section[_ngcontent-%COMP%]{padding:0 20px 18px}.section-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:10px}.section-label[_ngcontent-%COMP%]   .section-icon[_ngcontent-%COMP%]{font-size:18px;color:#888}.section-label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:14px;color:#888;text-transform:uppercase;letter-spacing:.5px}.address-card[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;background:#fafafa;border:1px solid #f0f0f0;border-radius:14px;padding:14px}.address-left[_ngcontent-%COMP%]{flex:1;min-width:0}.address-tag[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;font-family:latoBold,sans-serif;font-size:13px;color:#1a1a1a;margin-bottom:6px}.address-tag[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:15px;color:#f85c70}.address-text[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:13px;color:#888;line-height:1.4;margin:0}.change-link[_ngcontent-%COMP%]{background:none;border:none;font-family:latoBold,sans-serif;font-size:13px;color:#f85c70;cursor:pointer;padding:0;flex-shrink:0;margin-left:12px}.payment-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.payment-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:14px;width:100%;background:#fff;border:1.5px solid #eee;border-radius:14px;padding:14px 16px;cursor:pointer;transition:border-color .2s,background .2s;text-align:left}.payment-option.selected[_ngcontent-%COMP%]{border-color:#f85c70;background:#fff5f6}.payment-option.disabled[_ngcontent-%COMP%]{opacity:.55;cursor:not-allowed}.option-radio[_ngcontent-%COMP%]{flex-shrink:0}.radio-outer[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%;border:2px solid #ccc;display:flex;align-items:center;justify-content:center;transition:border-color .2s}.selected[_ngcontent-%COMP%]   .radio-outer[_ngcontent-%COMP%]{border-color:#f85c70}.radio-inner[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;background:#f85c70}.option-icon-wrap[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;background:#fff0f1;display:flex;align-items:center;justify-content:center;flex-shrink:0}.option-icon-wrap[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#f85c70}.option-icon-wrap.disabled-icon[_ngcontent-%COMP%]{background:#f0f0f0}.option-icon-wrap.disabled-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#999}.option-text[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:2px;min-width:0}.option-name[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:14px;color:#1a1a1a}.option-desc[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:12px;color:#888}.soon-tag[_ngcontent-%COMP%]{background:#f0f0f0;border-radius:8px;padding:3px 10px;font-family:latoBold,sans-serif;font-size:11px;color:#999;flex-shrink:0}.info-note[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;margin:0 20px 20px;padding:12px 14px;background:#fff8e1;border-radius:12px}.info-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;color:#f59e0b;flex-shrink:0;margin-top:1px}.info-note[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:13px;color:#92700c;line-height:1.4}.confirm-footer[_ngcontent-%COMP%]{background:#fff;border-top:1px solid #f0f0f0;padding:14px 20px;padding-bottom:calc(14px + env(safe-area-inset-bottom))}.footer-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.footer-total-label[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:14px;color:#888}.footer-total-amount[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:20px;color:#1a1a1a}.confirm-btn[_ngcontent-%COMP%]{width:100%;background:linear-gradient(135deg,#f85c70,#fc5c7d);color:#fff;font-family:latoBold,sans-serif;font-size:16px;border:none;border-radius:30px;padding:15px;cursor:pointer;transition:opacity .2s,transform .1s}.confirm-btn[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.98)}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.85;cursor:not-allowed}.confirm-btn.placing[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fa8a99,#fd8da0)}.placing-text[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px}.btn-spinner[_ngcontent-%COMP%]{width:20px;height:20px;--color: #fff}.error-note[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;margin:0 20px 20px;padding:12px 14px;background:#fff0f1;border-radius:12px;border:1px solid rgba(248,92,112,.2)}.error-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;color:#f85c70;flex-shrink:0;margin-top:1px}.error-note[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:13px;color:#c0392b;line-height:1.4}"]})}}return e})();var ce=[{path:"",component:X}],q=(()=>{class e{static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275mod=_({type:e})}static{this.\u0275inj=u({imports:[b.forChild(ce),b]})}}return e})();var Me=(()=>{class e{static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275mod=_({type:e})}static{this.\u0275inj=u({imports:[B,F,$,q]})}}return e})();export{X as a,Me as b};
