import{a as j}from"./chunk-INXSXU2S.js";import{a as k}from"./chunk-2UEUXISU.js";import{a as I}from"./chunk-XHFPWJXB.js";import"./chunk-RUV2QHWV.js";import"./chunk-G4UC2DN7.js";import{a as P}from"./chunk-4TOLQR2K.js";import{B as g,C as l,D as v,Da as y,E as p,Ha as d,Hb as C,S,T as x,Xb as A,kb as M,m as s,u as m,va as b,w as o,x as h,y as c}from"./chunk-GJ24JKLH.js";import"./chunk-B3I3XDBM.js";import"./chunk-QUJFQN2Y.js";import"./chunk-KSM42KW3.js";import"./chunk-KAYW723Y.js";import"./chunk-ZJWVYB4W.js";import"./chunk-WVHTM5RI.js";import"./chunk-IN6HLDFE.js";import"./chunk-GIMG75PD.js";import"./chunk-O5IUGFKF.js";import"./chunk-LHDZOLCP.js";import"./chunk-AEZ3F2AP.js";import"./chunk-7FY2OE2O.js";import"./chunk-5KM5ZX5B.js";import"./chunk-EAHJVID6.js";import"./chunk-FOH2II3V.js";import"./chunk-VZWY4NEG.js";import"./chunk-WI5MSH4N.js";import"./chunk-5SJVYNIP.js";import"./chunk-CKP3SGE2.js";import"./chunk-QLR5SVGL.js";import"./chunk-JHI3MBHO.js";var U=(()=>{class e{constructor(i,t,r,n,f){this.router=i,this.storageService=t,this.otpService=r,this.locationService=n,this.orderService=f,this.statusText="Hi! We are getting things ready for you...",this.resolved=!1}ionViewWillEnter(){this.resolveStartupRoute()}resolveStartupRoute(){if(this.resolved)return;if(this.resolved=!0,!this.storageService.getToken()){this.router.navigate(["/login"],{replaceUrl:!0});return}this.statusText="Restoring your session...",this.otpService.validateToken().subscribe({next:t=>{if(!(t?.status&&t?.data)){this.handleAuthFailure();return}let r=t.data.user;if(r&&this.storageService.saveUser(r),!t.data.hasDefaultAddress){this.router.navigate(["/shared/location-setup"],{replaceUrl:!0});return}let n=r?.addresses||[],u=(n.find(a=>a.defaultAddress||a.isDefault)||n[0])?.coords;if(u?.lat&&u?.lng){this.statusText="Checking service availability...",this.locationService.checkServiceArea(u).subscribe({next:a=>{a?.status&&a?.data?.serviceAvailable?this.navigateAfterServiceCheck(r._id):this.router.navigate(["/service-not-available"],{replaceUrl:!0})},error:()=>{this.router.navigate(["/tabs/home-main"],{replaceUrl:!0})}});return}this.navigateAfterServiceCheck(r._id)},error:()=>{this.handleAuthFailure()}})}navigateAfterServiceCheck(i){this.statusText="Almost ready...",this.orderService.getActiveOrder(i).subscribe({next:t=>{t?.data?.length>0?this.router.navigate(["/tabs/orders"],{replaceUrl:!0}):this.router.navigate(["/tabs/home-main"],{replaceUrl:!0})},error:()=>{this.router.navigate(["/tabs/home-main"],{replaceUrl:!0})}})}handleAuthFailure(){this.storageService.clean(),this.router.navigate(["/login"],{replaceUrl:!0})}static{this.\u0275fac=function(t){return new(t||e)(o(y),o(P),o(I),o(j),o(k))}}static{this.\u0275cmp=h({type:e,selectors:[["app-startup"]],standalone:!1,decls:6,vars:2,consts:[[1,"startup-content",3,"fullscreen"],["src","assets/startup-page.png","alt","Startup",1,"startup-bg"],[1,"startup-overlay"],["name","crescent"]],template:function(t,r){t&1&&(l(0,"ion-content",0),p(1,"img",1),l(2,"div",2),p(3,"ion-spinner",3),l(4,"p"),S(5),v()()()),t&2&&(g("fullscreen",!0),m(5),x(r.statusText))},dependencies:[M,C],styles:["ion-content.startup-content[_ngcontent-%COMP%]{--background: #000}.startup-bg[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}.startup-overlay[_ngcontent-%COMP%]{position:absolute;left:0;right:0;bottom:calc(40px + env(safe-area-inset-bottom));display:flex;flex-direction:column;align-items:center;gap:10px;color:#fff;text-align:center}.startup-overlay[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:28px;height:28px;color:#fff}.startup-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-family:latoBold,sans-serif;font-size:13px;letter-spacing:.3px;text-shadow:0 1px 4px rgba(0,0,0,.45)}"]})}}return e})();var w=[{path:"",component:U}],T=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=c({type:e})}static{this.\u0275inj=s({imports:[d.forChild(w),d]})}}return e})();var K=(()=>{class e{static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275mod=c({type:e})}static{this.\u0275inj=s({imports:[b,A,T]})}}return e})();export{K as StartupPageModule};
