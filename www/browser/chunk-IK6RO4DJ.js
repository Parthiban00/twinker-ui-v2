import{a as te}from"./chunk-7BSXQMCF.js";import{a as X}from"./chunk-2UEUXISU.js";import{a as ee}from"./chunk-5L56GRTK.js";import"./chunk-RUV2QHWV.js";import"./chunk-G4UC2DN7.js";import{B as d,Ba as A,C as i,D as o,Da as F,E as s,F as z,G as D,Ha as I,Hb as H,I as P,J as b,Jb as Y,K as m,L as R,Lb as J,M as L,N as j,R as N,S as c,T as O,U as _,Xb as K,db as Z,eb as Q,ha as W,kb as $,la as U,m as x,o as C,p as M,pb as q,qb as G,r as w,t as S,u as a,va as V,w as y,x as E,y as h,z as v}from"./chunk-GJ24JKLH.js";import"./chunk-B3I3XDBM.js";import"./chunk-QUJFQN2Y.js";import"./chunk-KSM42KW3.js";import"./chunk-KAYW723Y.js";import"./chunk-ZJWVYB4W.js";import"./chunk-WVHTM5RI.js";import"./chunk-IN6HLDFE.js";import"./chunk-GIMG75PD.js";import"./chunk-O5IUGFKF.js";import"./chunk-LHDZOLCP.js";import"./chunk-AEZ3F2AP.js";import"./chunk-7FY2OE2O.js";import"./chunk-5KM5ZX5B.js";import"./chunk-EAHJVID6.js";import"./chunk-FOH2II3V.js";import"./chunk-VZWY4NEG.js";import"./chunk-WI5MSH4N.js";import"./chunk-5SJVYNIP.js";import"./chunk-CKP3SGE2.js";import"./chunk-QLR5SVGL.js";import{e as k}from"./chunk-JHI3MBHO.js";var ae=["mapRef"];function le(t,p){if(t&1&&(i(0,"ion-buttons",10)(1,"span",11),c(2),o()()),t&2){let e=m();a(),N("status-"+e.order.status),a(),_(" ",e.getStatusLabel(e.order.status)," ")}}function ce(t,p){t&1&&(i(0,"div",12),s(1,"ion-spinner",13),i(2,"p"),c(3,"Loading map..."),o()())}function de(t,p){t&1&&(i(0,"div",19),s(1,"ion-icon",20),i(2,"span"),c(3,"Live tracking starts when the order is out for delivery"),o()())}function se(t,p){if(t&1&&s(0,"img",32),t&2){let e=m(3);d("src",e.deliveryBoy.imageUrl,S)}}function pe(t,p){t&1&&(i(0,"div",33),s(1,"ion-icon",34),o())}function ge(t,p){if(t&1&&(i(0,"span",35),s(1,"ion-icon",36),c(2),o()),t&2){let e=m(3);a(2),_(" ",e.deliveryBoy.vehicleNo," ")}}function fe(t,p){if(t&1){let e=P();i(0,"button",37),b("click",function(){C(e);let r=m(3);return M(r.callDeliveryBoy())}),s(1,"ion-icon",38),c(2," Call "),o()}}function me(t,p){if(t&1){let e=P();i(0,"button",39),b("click",function(){C(e);let r=m(3);return M(r.openDirections())}),s(1,"ion-icon",40),c(2," Directions "),o()}}function ue(t,p){if(t&1&&(i(0,"div",21)(1,"div",22),v(2,se,1,1,"img",23)(3,pe,2,0,"div",24),o(),i(4,"div",25)(5,"span",26),c(6),o(),i(7,"span",27),c(8,"Your delivery partner"),o(),v(9,ge,3,1,"span",28),o(),i(10,"div",29),v(11,fe,3,0,"button",30)(12,me,3,0,"button",31),o()()),t&2){let e=m(2);a(2),d("ngIf",e.deliveryBoy==null?null:e.deliveryBoy.imageUrl),a(),d("ngIf",!(e.deliveryBoy!=null&&e.deliveryBoy.imageUrl)),a(3),O((e.deliveryBoy==null?null:e.deliveryBoy.name)||"Delivery Partner"),a(3),d("ngIf",e.deliveryBoy==null?null:e.deliveryBoy.vehicleNo),a(2),d("ngIf",e.deliveryBoy==null?null:e.deliveryBoy.phone),a(),d("ngIf",e.deliveryBoy==null||e.deliveryBoy.location==null?null:e.deliveryBoy.location.latitude)}}function ye(t,p){if(t&1&&(i(0,"div",41)(1,"div",42),s(2,"ion-icon",43),i(3,"div",44)(4,"span",45),c(5,"Estimated arrival"),o(),i(6,"span",46),c(7),o()()(),i(8,"div",47)(9,"span",48),c(10),o(),i(11,"span",49),c(12),o(),i(13,"span",50),c(14),o()()()),t&2){let e=m(2);a(7),_("~",e.estimatedMinutes," min"),a(3),O(e.order.orderId),a(2),_("\u20B9",e.order.totalAmount==null?null:e.order.totalAmount.toFixed(0)),a(2),O(e.order.paymentMethod==="cod"?"COD":"Online")}}function ve(t,p){if(t&1&&(z(0),i(1,"div",14),s(2,"div",15,0),v(4,de,4,0,"div",16),o(),v(5,ue,13,6,"div",17)(6,ye,15,4,"div",18),D()),t&2){let e=m();a(4),d("ngIf",(e.order==null?null:e.order.status)!=="out_for_delivery"),a(),d("ngIf",(e.deliveryBoy==null?null:e.deliveryBoy.name)||(e.deliveryBoy==null?null:e.deliveryBoy.phone)),a(),d("ngIf",e.order)}}var ie=(()=>{class t{constructor(e,n,r,l,u,g,f){this.route=e,this.router=n,this.orderService=r,this.gmapsService=l,this.commonService=u,this.cdr=g,this.ngZone=f,this.orderId="",this.order=null,this.isLoading=!0,this.map=null,this.deliveryBoyMarker=null,this.trackInterval=null}ionViewWillEnter(){this.route.queryParams.subscribe(e=>{this.orderId=e.orderId||"",this.orderId&&this.loadOrder()})}ionViewWillLeave(){this.stopTracking()}ngOnDestroy(){this.stopTracking()}stopTracking(){this.trackInterval&&(clearInterval(this.trackInterval),this.trackInterval=null)}loadOrder(){this.isLoading=!0,this.orderService.getOrderById(this.orderId).subscribe({next:e=>{this.ngZone.run(()=>k(this,null,function*(){this.order=e?.data||null,this.isLoading=!1,this.cdr.detectChanges(),this.order&&setTimeout(()=>this.initMap(),200)}))},error:()=>{this.ngZone.run(()=>{this.isLoading=!1,this.cdr.detectChanges()})}})}initMap(){return k(this,null,function*(){try{let e=yield this.gmapsService.loadGoogleMaps(),n=this.order?.deliveryAddress?.coords,r={lat:n?.lat||9.8472923,lng:n?.lng||78.47478};this.map=new e.Map(this.mapRef.nativeElement,{center:r,zoom:14,mapTypeId:"roadmap",disableDefaultUI:!0,zoomControl:!0,styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]});let l=this.order?.vendorOrders||[],u=new e.LatLngBounds;for(let g of l){let f=g.vendor;if(f?.latitude&&f?.longitude){let B={lat:parseFloat(f.latitude),lng:parseFloat(f.longitude)},T=new e.Marker({position:B,map:this.map,title:g.vendorName||f.name,icon:{path:e.SymbolPath.CIRCLE,fillColor:"#e74c3c",fillOpacity:1,strokeColor:"#fff",strokeWeight:2,scale:10},label:{text:(g.vendorName||f.name||"V").charAt(0),color:"#fff",fontSize:"11px",fontWeight:"bold"}}),re=new e.InfoWindow({content:`<div style="font-family:sans-serif;font-size:13px;padding:4px"><strong>${g.vendorName||f.name}</strong><br><span style="color:#888;font-size:11px">Pickup Point</span></div>`});T.addListener("click",()=>re.open(this.map,T)),u.extend(B)}}if(n?.lat&&n?.lng){let g={lat:n.lat,lng:n.lng};new e.Marker({position:g,map:this.map,title:"Your Location",icon:{path:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z",fillColor:"#2ecc71",fillOpacity:1,strokeColor:"#fff",strokeWeight:2,scale:1.5,anchor:new e.Point(12,22)}}),u.extend(g)}this.order?.deliveryBoy?.location?.latitude&&(this.addOrUpdateDeliveryBoyMarker(e),u.extend({lat:this.order.deliveryBoy.location.latitude,lng:this.order.deliveryBoy.location.longitude})),u.isEmpty()||this.map.fitBounds(u),this.order?.status==="out_for_delivery"&&this.startTrackingPoll()}catch(e){console.error("Map init error",e)}})}addOrUpdateDeliveryBoyMarker(e){let n=this.order?.deliveryBoy?.location;if(!n?.latitude||!n?.longitude)return;let r={lat:n.latitude,lng:n.longitude};if(this.deliveryBoyMarker){this.deliveryBoyMarker.setPosition(r);return}let l=e||window.google?.maps;l&&(this.deliveryBoyMarker=new l.Marker({position:r,map:this.map,title:this.order?.deliveryBoy?.name||"Delivery Partner",icon:{path:l.SymbolPath.FORWARD_CLOSED_ARROW,fillColor:"#F85C70",fillOpacity:1,strokeColor:"#fff",strokeWeight:2,scale:6,rotation:0},animation:l.Animation.BOUNCE}))}startTrackingPoll(){this.stopTracking(),this.trackInterval=setInterval(()=>this.refreshLocation(),5e3)}refreshLocation(){this.orderId&&this.orderService.getOrderById(this.orderId).subscribe({next:e=>{let n=e?.data;if(!n)return;["placed","confirmed","out_for_delivery"].includes(n.status)||this.stopTracking();let r=this.order?.deliveryBoy?.location,l=n?.deliveryBoy?.location;this.order=n,l?.latitude&&l?.longitude&&(!r||r.latitude!==l.latitude||r.longitude!==l.longitude)&&this.ngZone.run(()=>{this.addOrUpdateDeliveryBoyMarker(),this.cdr.detectChanges()})}})}get deliveryBoy(){return this.order?.deliveryBoy}get estimatedMinutes(){if(!this.order?.estimatedDeliveryTime)return 30;let e=new Date(this.order.estimatedDeliveryTime).getTime()-Date.now();return Math.max(0,Math.ceil(e/6e4))}callDeliveryBoy(){let e=this.deliveryBoy?.phone;e&&window.open(`tel:${e}`)}openDirections(){let e=this.deliveryBoy?.location;e?.latitude&&e?.longitude&&window.open(`https://maps.google.com/?q=${e.latitude},${e.longitude}`)}getStatusLabel(e){return{placed:"Order Placed",confirmed:"Confirmed",out_for_delivery:"On the Way",delivered:"Delivered",cancelled:"Cancelled"}[e]||e}goBack(){this.router.navigate(["/tabs/orders"])}static{this.\u0275fac=function(n){return new(n||t)(y(A),y(F),y(X),y(te),y(ee),y(W),y(w))}}static{this.\u0275cmp=E({type:t,selectors:[["app-order-tracking"]],viewQuery:function(n,r){if(n&1&&R(ae,5),n&2){let l;L(l=j())&&(r.mapRef=l.first)}},standalone:!1,decls:11,vars:3,consts:[["mapRef",""],[1,"ion-no-border"],["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back","color","dark"],[1,"tracking-title"],["slot","end",4,"ngIf"],[1,"tracking-content"],["class","loading-wrap",4,"ngIf"],[4,"ngIf"],["slot","end"],[1,"status-badge"],[1,"loading-wrap"],["name","crescent","color","primary"],[1,"map-container"],[1,"map-element"],["class","map-overlay-hint",4,"ngIf"],["class","delivery-boy-card",4,"ngIf"],["class","eta-strip",4,"ngIf"],[1,"map-overlay-hint"],["name","navigate-circle-outline"],[1,"delivery-boy-card"],[1,"db-avatar"],["alt","Delivery partner",3,"src",4,"ngIf"],["class","db-avatar-placeholder",4,"ngIf"],[1,"db-info"],[1,"db-name"],[1,"db-role"],["class","db-vehicle",4,"ngIf"],[1,"db-actions"],["class","db-call-btn",3,"click",4,"ngIf"],["class","db-dir-btn",3,"click",4,"ngIf"],["alt","Delivery partner",3,"src"],[1,"db-avatar-placeholder"],["name","person-outline"],[1,"db-vehicle"],["name","car-outline"],[1,"db-call-btn",3,"click"],["name","call-outline"],[1,"db-dir-btn",3,"click"],["name","navigate-outline"],[1,"eta-strip"],[1,"eta-left"],["name","time-outline"],[1,"eta-text"],[1,"eta-label"],[1,"eta-value"],[1,"eta-right"],[1,"eta-order-id"],[1,"eta-amount"],[1,"eta-payment"]],template:function(n,r){n&1&&(i(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2)(3,"ion-button",3),b("click",function(){return r.goBack()}),s(4,"ion-icon",4),o()(),i(5,"ion-title",5),c(6,"Order Tracking"),o(),v(7,le,3,3,"ion-buttons",6),o()(),i(8,"ion-content",7),v(9,ce,4,0,"div",8)(10,ve,7,3,"ng-container",9),o()),n&2&&(a(7),d("ngIf",r.order),a(2),d("ngIf",r.isLoading),a(),d("ngIf",!r.isLoading))},dependencies:[U,Z,Q,$,q,G,H,Y,J],styles:["ion-toolbar[_ngcontent-%COMP%]{--background: #fff}.tracking-title[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:17px;color:#1a1a1a}.status-badge[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:11px;border-radius:20px;padding:4px 12px;margin-right:8px}.status-badge.status-placed[_ngcontent-%COMP%]{background:#f85c701f;color:#f85c70}.status-badge.status-confirmed[_ngcontent-%COMP%]{background:#4a5bf51f;color:#4a5bf5}.status-badge.status-out_for_delivery[_ngcontent-%COMP%], .status-badge.status-delivered[_ngcontent-%COMP%]{background:#2ecc711f;color:#2ecc71}.status-badge.status-cancelled[_ngcontent-%COMP%]{background:#e74c3c1f;color:#e74c3c}.tracking-content[_ngcontent-%COMP%]{--background: #f5f5f5}.loading-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:80px 16px;gap:16px}.loading-wrap[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:14px;color:#888;margin:0}.map-container[_ngcontent-%COMP%]{position:relative;width:100%;height:55vh;background:#e8e8e8}.map-element[_ngcontent-%COMP%]{width:100%;height:100%}.map-overlay-hint[_ngcontent-%COMP%]{position:absolute;bottom:16px;left:50%;transform:translate(-50%);background:#000000a6;color:#fff;border-radius:20px;padding:8px 16px;display:flex;align-items:center;gap:6px;backdrop-filter:blur(4px)}.map-overlay-hint[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px;color:#fffc}.map-overlay-hint[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:12px;white-space:nowrap}.delivery-boy-card[_ngcontent-%COMP%]{background:#fff;margin:12px 16px 0;border-radius:14px;padding:14px;display:flex;align-items:center;gap:12px;box-shadow:0 2px 8px #00000012}.db-avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;overflow:hidden;flex-shrink:0;background:#f0f0f0}.db-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.db-avatar-placeholder[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#f85c7026,#fc8c5c26)}.db-avatar-placeholder[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#f85c70}.db-info[_ngcontent-%COMP%]{flex:1;min-width:0;display:flex;flex-direction:column;gap:2px}.db-name[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:15px;color:#1a1a1a}.db-role[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:12px;color:#888}.db-vehicle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-family:latoRegular,sans-serif;font-size:12px;color:#888;margin-top:2px}.db-vehicle[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:13px}.db-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;flex-shrink:0}.db-call-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;background:#2ecc71;border:none;border-radius:16px;padding:7px 14px;color:#fff;font-family:latoBold,sans-serif;font-size:13px;cursor:pointer}.db-call-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.db-dir-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;background:none;border:1.5px solid #F85C70;border-radius:16px;padding:6px 14px;color:#f85c70;font-family:latoBold,sans-serif;font-size:13px;cursor:pointer}.db-dir-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.eta-strip[_ngcontent-%COMP%]{background:#fff;margin:10px 16px 16px;border-radius:14px;padding:14px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;box-shadow:0 2px 8px #00000012}.eta-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.eta-left[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#f85c70;flex-shrink:0}.eta-text[_ngcontent-%COMP%]{display:flex;flex-direction:column}.eta-label[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:11px;color:#888}.eta-value[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:18px;color:#1a1a1a}.eta-right[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:2px}.eta-order-id[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:11px;color:#888}.eta-amount[_ngcontent-%COMP%]{font-family:latoBold,sans-serif;font-size:15px;color:#1a1a1a}.eta-payment[_ngcontent-%COMP%]{font-family:latoRegular,sans-serif;font-size:11px;color:#888;background:#f0f0f0;border-radius:6px;padding:2px 8px}"]})}}return t})();var _e=[{path:"",component:ie}],oe=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=h({type:t})}static{this.\u0275inj=x({imports:[I.forChild(_e),I]})}}return t})();var Re=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=h({type:t})}static{this.\u0275inj=x({imports:[V,K,oe]})}}return t})();export{Re as OrderTrackingPageModule};
